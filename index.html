<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Portfolio Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            color: #333;
            font-family: Inter, system-ui, sans-serif;
        }

        .card {
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card h2 {
            color: #0d6efd;
            margin-bottom: 15px;
        }

        .projects-list .project-item {
            background: #e9ecef;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container py-4">

        <header class="mb-4 text-center">
            <h1 class="fw-bold">Portfolio Admin</h1>
            <p class="text-muted">Manage your portfolio content</p>
        </header>

        <!-- ABOUT FORM -->
        <form id="aboutForm">
            <div class="card">
                <h2>About</h2>
                <div class="mb-3">
                    <label for="aboutBio" class="form-label">Bio</label>
                    <textarea id="aboutBio" rows="3" class="form-control"></textarea>
                </div>
                <div class="row g-3 mb-3">
                    <div class="col">
                        <label for="aboutExp" class="form-label">Experience</label>
                        <input type="text" id="aboutExp" class="form-control" placeholder="10+">
                    </div>
                    <div class="col">
                        <label for="aboutProjects" class="form-label">Projects Completed</label>
                        <input type="text" id="aboutProjects" class="form-control" placeholder="03">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="resumeUrl" class="form-label">Resume URL</label>
                    <input type="text" id="resumeUrl" class="form-control" placeholder="https://...">
                </div>
                <div class="mb-3">
                    <label for="aboutImg" class="form-label">Profile Image URL</label>
                    <input type="text" id="aboutImg" class="form-control" placeholder="https://...">
                </div>
                <button type="submit" class="btn btn-primary">Save About</button>
            </div>
        </form>

        <!-- SKILLS FORM -->
        <form id="skillsForm">
            <div class="card">
                <h2>Skills</h2>
                <div class="mb-3">
                    <label for="technicalSkills" class="form-label">Technical Skills (comma separated)</label>
                    <textarea id="technicalSkills" rows="2" class="form-control"></textarea>
                </div>
                <div class="mb-3">
                    <label for="toolSkills" class="form-label">Tools (comma separated)</label>
                    <textarea id="toolSkills" rows="2" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Skills</button>
            </div>
        </form>

        <!-- PROJECTS FORM -->
        <form id="projectsForm">
            <div class="card">
                <h2>Projects</h2>
                <div class="row g-2 mb-2">
                    <div class="col-md-6">
                        <input id="projTitle" class="form-control" placeholder="Project Title">
                    </div>
                    <div class="col-md-6">
                        <input id="projImg" class="form-control" placeholder="Image URL">
                    </div>
                </div>
                <div class="mb-2">
                    <input id="projLink" class="form-control mb-2" placeholder="Project URL">
                    <input id="projBtnText" class="form-control mb-2" placeholder="Button Text">
                    <textarea id="projDesc" rows="2" class="form-control" placeholder="Description"></textarea>
                </div>
                <div class="d-flex gap-2 mb-2 flex-wrap">
                    <button type="button" class="btn btn-primary" onclick="addProjectToList()">Add Project</button>
                    <button type="button" class="btn btn-secondary" onclick="clearProjectInputs()">Clear</button>
                </div>
                <div id="projectsList" class="projects-list"></div>
                <div class="d-flex gap-2 mt-2 flex-wrap">
                    <button type="submit" class="btn btn-primary">Save All Projects</button>
                    <button type="button" class="btn btn-secondary" onclick="loadProjectsForEdit()">Reload</button>
                </div>
            </div>
        </form>

        <footer class="text-center mt-4 text-muted">
            Made for <strong>Mithu</strong> â€” Firestore Connected
        </footer>
    </div>

    <!-- Firebase + JS -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDLPUtK-NGtlOQUdS_Fe19NqcRiz3eFeCk",
    authDomain: "portfolio-update-cc2b4.firebaseapp.com",
    projectId: "portfolio-update-cc2b4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const $ = id => document.getElementById(id);
  let projectsBuffer = [];

  // ------------------ LOAD DATA ------------------
  async function loadAllPrefill() {
    try {
      const aboutSnap = await getDoc(doc(db, "portfolio", "about"));
      if (aboutSnap.exists()) {
        const d = aboutSnap.data();
        $("aboutBio").value = d.bio || "";
        $("aboutExp").value = d.experience || "";
        $("aboutProjects").value = d.projectsDone || "";
        $("resumeUrl").value = d.resumeUrl || "";
        $("aboutImg").value = d.aboutImg || "";
      }
    } catch(e){ console.error("load about:", e); }

    try {
      const skillsSnap = await getDoc(doc(db, "portfolio", "skills"));
      if (skillsSnap.exists()){
        const s = skillsSnap.data();
        $("technicalSkills").value = (s.technical||[]).join(", ");
        $("toolSkills").value = (s.tools||[]).join(", ");
      }
    } catch(e){ console.error("load skills:", e); }

    await loadProjectsForEdit();
  }

  async function loadProjectsForEdit(){
    try {
      const projSnap = await getDoc(doc(db, "portfolio", "projects"));
      projectsBuffer = projSnap.exists() ? projSnap.data().projects || [] : [];
    } catch(e){ console.error("load projects:", e); }
    renderProjectsList();
  }

  function renderProjectsList(){
    const list = $("projectsList");
    list.innerHTML = "";
    projectsBuffer.forEach((p, idx)=>{
      const item = document.createElement("div");
      item.className = "project-item d-flex justify-content-between align-items-start flex-wrap";
      item.innerHTML = `
        <div class="flex-grow-1">
          <input class="pTitle mb-1 form-control" data-idx="${idx}" value="${p.title||''}" placeholder="Title">
          <input class="pImg mb-1 form-control" data-idx="${idx}" value="${p.img||''}" placeholder="Image URL">
          <input class="pLink mb-1 form-control" data-idx="${idx}" value="${p.link||''}" placeholder="Link">
          <input class="pBtn mb-1 form-control" data-idx="${idx}" value="${p.linkText||''}" placeholder="Button Text">
          <textarea class="pDesc mb-1 form-control" data-idx="${idx}" rows="2" placeholder="Description">${p.desc||''}</textarea>
        </div>
        <div class="d-flex flex-column gap-1 ms-2">
          <button type="button" class="btn btn-secondary btn-sm" onclick="editProject(${idx})">Save</button>
          <button type="button" class="btn btn-secondary btn-sm" onclick="removeProject(${idx})">Remove</button>
        </div>
      `;
      list.appendChild(item);
    });
  }

  function escapeHtml(s=''){ return String(s).replaceAll('"','&quot;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // ------------------ PROJECTS ------------------
  window.addProjectToList = function(){
    const p = {
      title: $("projTitle").value.trim(),
      desc: $("projDesc").value.trim(),
      img: $("projImg").value.trim(),
      link: $("projLink").value.trim(),
      linkText: $("projBtnText").value.trim() || "View"
    };
    if (!p.title) { alert("Enter project title"); return; }
    projectsBuffer.push(p);
    renderProjectsList();
    clearProjectInputs();
  }

  window.clearProjectInputs = function(){
    $("projTitle").value=""; $("projDesc").value=""; $("projImg").value=""; $("projLink").value=""; $("projBtnText").value="";
  }

  window.editProject = function(idx){
    const list = document.querySelectorAll("#projectsList .project-item")[idx];
    if (!list) return;
    projectsBuffer[idx] = {
      title: list.querySelector(".pTitle").value,
      img: list.querySelector(".pImg").value,
      link: list.querySelector(".pLink").value,
      linkText: list.querySelector(".pBtn").value,
      desc: list.querySelector(".pDesc").value
    };
    renderProjectsList();
  }

  window.removeProject = function(idx){
    projectsBuffer.splice(idx,1);
    renderProjectsList();
  }

  // ------------------ FORM SUBMITS ------------------
  $("aboutForm").addEventListener("submit", async function(e){
    e.preventDefault();
    try {
      await setDoc(doc(db, "portfolio", "about"), {
        bio: $("aboutBio").value.trim(),
        experience: $("aboutExp").value.trim(),
        projectsDone: $("aboutProjects").value.trim(),
        resumeUrl: $("resumeUrl").value.trim(),
        aboutImg: $("aboutImg").value.trim()
      });
      alert("About saved!");
      this.reset();
    } catch(e){ console.error(e); alert("Error saving about: "+e.message); }
  });

  $("skillsForm").addEventListener("submit", async function(e){
    e.preventDefault();
    try {
      const technical = ($("technicalSkills").value || "").split(",").map(s=>s.trim()).filter(Boolean);
      const tools = ($("toolSkills").value || "").split(",").map(s=>s.trim()).filter(Boolean);
      await setDoc(doc(db, "portfolio", "skills"), { technical, tools });
      alert("Skills saved!");
      this.reset();
    } catch(e){ console.error(e); alert("Error saving skills: "+e.message); }
  });

  $("projectsForm").addEventListener("submit", async function(e){
    e.preventDefault();
    try {
      await setDoc(doc(db, "portfolio", "projects"), { projects: projectsBuffer });
      alert("Projects saved!");
      this.reset();
      projectsBuffer = [];
      renderProjectsList();
    } catch(e){ console.error(e); alert("Error saving projects: "+e.message); }
  });

  loadAllPrefill();
</script>
</body>

</html>