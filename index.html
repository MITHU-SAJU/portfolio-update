<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Portfolio Admin Panel</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }

        h2 {
            margin-top: 40px;
        }

        textarea,
        input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
        }

        .btn {
            background: black;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .project-box {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <h1>Portfolio Admin Panel</h1>

    <!-- ABOUT SECTION -->
    <h2>About Section</h2>
    <textarea id="aboutBio" rows="4" placeholder="Bio"></textarea>
    <input id="aboutExp" placeholder="Experience (eg. 10+)" />
    <input id="aboutProjects" placeholder="Projects Completed (eg. 03)" />
    <button class="btn" onclick="updateAbout()">Update About</button>

    <!-- SKILLS SECTION -->
    <h2>Skills Section</h2>
    <textarea id="technicalSkills" rows="3" placeholder="Technical Skills (comma separated)"></textarea>
    <textarea id="toolSkills" rows="3" placeholder="Tools (comma separated)"></textarea>
    <button class="btn" onclick="updateSkills()">Update Skills</button>

    <!-- PROJECTS SECTION -->
    <h2>Projects Section</h2>
    <div id="projectsContainer"></div>
    <button class="btn" onclick="addProjectForm()">+ Add Project</button>
    <br><br>
    <button class="btn" onclick="updateProjects()">Save All Projects</button>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDLPUtK-NGtlOQUdS_Fe19NqcRiz3eFeCk",
        authDomain: "portfolio-update-cc2b4.firebaseapp.com",
        projectId: "portfolio-update-cc2b4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const docRef = doc(db, "portfolio", "content");

    // Load existing data
    async function loadData() {
        const snap = await getDoc(docRef);
        if (!snap.exists()) return;

        const data = snap.data();

        // ABOUT
        document.getElementById("aboutBio").value = data.about?.bio || "";
        document.getElementById("aboutExp").value = data.about?.experience || "";
        document.getElementById("aboutProjects").value = data.about?.projectsCount || "";

        // SKILLS
        document.getElementById("technicalSkills").value = (data.skills?.technical || []).join(", ");
        document.getElementById("toolSkills").value = (data.skills?.tools || []).join(", ");

        // PROJECTS
        if (data.projects) {
            data.projects.forEach(p => addProjectForm(p));
        }
    }

    loadData();

    // -------------------- UPDATE ABOUT --------------------
    window.updateAbout = async function () {
        await updateDoc(docRef, {
            about: {
                bio: document.getElementById("aboutBio").value,
                experience: document.getElementById("aboutExp").value,
                projectsCount: document.getElementById("aboutProjects").value
            }
        });
        alert("About Updated!");
    };

    // -------------------- UPDATE SKILLS --------------------
    window.updateSkills = async function () {
        const technical = document.getElementById("technicalSkills").value.split(",").map(s=>s.trim());
        const tools = document.getElementById("toolSkills").value.split(",").map(s=>s.trim());

        await updateDoc(docRef, {
            skills: { technical, tools }
        });
        alert("Skills Updated!");
    };

    // -------------------- ADD PROJECT FORM --------------------
    window.addProjectForm = function (data = {}) {
        const container = document.getElementById("projectsContainer");

        const box = document.createElement("div");
        box.className = "project-box";

        box.innerHTML = `
            <input placeholder="Project Title" class="pTitle" value="${data.title || ""}">
            <textarea placeholder="Description" class="pDesc">${data.description || ""}</textarea>
            <input placeholder="Image URL" class="pImg" value="${data.img || ""}">
            <input placeholder="Project Link" class="pLink" value="${data.link || ""}">
            <button class="btn" onclick="this.parentElement.remove()">Remove</button>
        `;

        container.appendChild(box);
    };

    // -------------------- SAVE PROJECTS --------------------
    window.updateProjects = async function () {
        const boxes = document.querySelectorAll(".project-box");

        const projects = [...boxes].map(box => ({
            title: box.querySelector(".pTitle").value,
            description: box.querySelector(".pDesc").value,
            img: box.querySelector(".pImg").value,
            link: box.querySelector(".pLink").value
        }));

        await updateDoc(docRef, { projects });
        alert("Projects Updated!");
    };
</script>

</body>

</html>